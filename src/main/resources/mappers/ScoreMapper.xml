<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--my batis 가 인터페이스역할을 하는거임-->

<!--    namespace 에는 연결할 인터페이스의 풀네임     -->
<!--    설정 파일에 매퍼 등록    -->
<mapper namespace="com.study.springstudy.springmvc.chap03.mapper.ScoreMapper">

    // 저장소에 데이터 추가하기
    boolean save(Score score);

    <insert id="save">
        INSERT INTO tbl_score
            (stu_name, kor, eng, math, total, average, grade)
        VALUES
            (#{stuName}, #{kor}, #{eng},
            #{math}, #{total}, #{average}, #{grade})
    </insert>

    // 저장소에서 데이터 전체조회하기
    List<Score> findAll(String sort);
    // 셀렉트는 result type 써야함
    <select id="findAll" resultType="score">
        SELECT * FROM tbl_score

    </select>

    // 저장소에서 데이터 개별조회하기
    Score findOne(long stuNum);
    <select id="findOne" resultType="score">
        SELECT * FROM tbl_score
        WHERE stu_num = #{stuNum}
    </select>


    // 저장소에서 데이터 삭제하기
    boolean delete(long stuNum);
    <delete id="delete">
        DELETE FROM tbl_score
        WHERE stu_num = #{stu_num}
    </delete>

    // 저장소에서 등수, 전체인원 조회하기
    int[] findRankByStuNum(long stuNum);
    <select id="findRankByStuNum" resultType="int">
        SELECT A.stu_num, A.rank, A.cnt
        FROM (SELECT *,
                RANK() OVER (ORDER BY average DESC) AS rank,
                 COUNT(*) OVER() AS cnt
                FROM tbl_score) A
        WHERE A.stu_num = #{stuNum}
    </select>


    // 저장소에서 국영수 점수 수정하기
    boolean updateScore(Score s);
    <update id="updateScore">
        UPDATE tbl_score
        SET kor = #{kor}, eng = #{eng}, math = #{math},
            total = #{total}, average = #{average}, grade = #{grade}
        WHERE stu_num = #{stu_num}

    </update>


</mapper>